<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="preload" href="/horizon-atlas/_next/static/css/43d771fade83ccf9.css" as="style"/><link rel="stylesheet" href="/horizon-atlas/_next/static/css/43d771fade83ccf9.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/horizon-atlas/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/horizon-atlas/_next/static/chunks/webpack-d6b9fb8b967c62fc.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/framework-a6b3d2fb26bce5d1.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/main-17de9138735c079b.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/pages/_app-4ff5b0e6267ccde7.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/019d026b-098b74cb779c3b0d.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/fea29d9f-dfee5f8797568931.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/41155975-57e00c569646619d.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/68c0a17d-506338dcc33b54ec.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/ebc70433-f2ab0dbd5b778f3d.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/117b9d7f-b10fdd21b2f0939d.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/257e8032-4f94a427f00c1f50.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/cb355538-193e0b5c5d7db318.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/860-6124e3a5f0abff91.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/396-e21666584d7c3a12.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/855-40a8b69cc32cc053.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/pages/posts/curriculums/%5BcurriculumId%5D/%5BpageId%5D-df2c329afb78fda7.js" defer=""></script><script src="/horizon-atlas/_next/static/wmHzTY2ca4DNxQWEGX6zJ/_buildManifest.js" defer=""></script><script src="/horizon-atlas/_next/static/wmHzTY2ca4DNxQWEGX6zJ/_ssgManifest.js" defer=""></script></head><body class="antialiased"><div id="__next"><div class="fixed inset-0 flex justify-center items-center bg-black bg-opacity-50"><div class="bg-white p-6 rounded-lg shadow-lg w-96"><h2 class="text-xl font-bold mb-4">ログインが必要です</h2><button class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">OK</button></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metadata":{"title":"データベース基礎","curriculumId":"1ada501e-f337-81e8-b251-df0f38a0cb23","category":"後期","visibility":["基礎班","発展班"],"tags":["基礎班","データベース","Python"],"is_basic_curriculum":true,"id":"101"},"mdBlocks":[{"blockId":"1ada501e-f337-817f-bfb7-cd3cc4cb7789","type":"paragraph","parent":"今回は、CRUD操作をする使い回し可能な関数の作り方の一例を紹介します。","children":[]},{"blockId":"1ada501e-f337-810d-9a84-f37a0d8a8d08","type":"paragraph","parent":"なお、**今回示す例はすべて、「**[**データベースとの接続とテーブルの作成**](/posts/curriculums/1ada501e-f337-81e8-b251-df0f38a0cb23/1ada501e-f337-8160-b03e-f28f8a18fa43)**」で作成したデータベースを操作する関数となっています。**テーブルのカラムなどを知りたい方はそちらのページをご覧ください。","children":[]},{"blockId":"1ada501e-f337-811d-9834-c8cd09505ce7","type":"heading_2","parent":"## 共通の部分","children":[]},{"blockId":"1ada501e-f337-81b2-8c56-cf50d16472e0","type":"divider","parent":"---","children":[]},{"blockId":"1ada501e-f337-8101-ad05-e1843f805c91","type":"paragraph","parent":"まず、CRUD操作はすべて、データベースとの接続が不可欠です。","children":[]},{"blockId":"1ada501e-f337-8161-b856-debfe9eb4311","type":"paragraph","parent":"ですので、データベースと接続する部分のコードはCRUD操作をする関数の共通部分となります。","children":[]},{"blockId":"1ada501e-f337-81e4-941e-d3e38c8d9ce8","type":"paragraph","parent":"「[**データベースとの接続とテーブルの作成**](/posts/curriculums/1ada501e-f337-81e8-b251-df0f38a0cb23/1ada501e-f337-8160-b03e-f28f8a18fa43)」においてすでに紹介しましたが、改めてデータベースと接続するコードを見ておきましょう。","children":[]},{"blockId":"1ada501e-f337-811a-8d1a-e38ab258be27","type":"callout","parent":"\u003e データベースと接続するコード  \n\u003e ```python  \n\u003e dbname = 'TEST.db'  \n\u003e conn = sqlite3.connect(dbname)  \n\u003e cur = conn.cursor()  \n\u003e   \n\u003e conn.commit()  \n\u003e   \n\u003e cur.close()  \n\u003e conn.close()  \n\u003e ```","children":[{"blockId":"1ada501e-f337-813a-b56e-d4a80f5d389e","type":"code","parent":"```python\ndbname = 'TEST.db'\nconn = sqlite3.connect(dbname)\ncur = conn.cursor()\n\nconn.commit()\n\ncur.close()\nconn.close()\n```","children":[]}]},{"blockId":"1ada501e-f337-81ff-b372-c65aed82afc0","type":"paragraph","parent":"このコードがCRUD操作をする関数の共通部分となります。`conn.commit()`がデータベースへの操作を確定する部分となるので、その上にデータベースを操作するコードを付け足すことになります。","children":[]},{"blockId":"1ada501e-f337-816a-b2c1-e11efe25f4e4","type":"heading_2","parent":"## データの保存","children":[]},{"blockId":"1ada501e-f337-81b6-b748-f4e3918596a2","type":"divider","parent":"---","children":[]},{"blockId":"1ada501e-f337-8177-b7cf-e6e3343ee8d0","type":"paragraph","parent":"データを保存するための使い回し可能な関数の一例を示します。","children":[]},{"blockId":"1ada501e-f337-81bb-a0a3-e84d34b7df21","type":"callout","parent":"\u003e データを保存する関数  \n\u003e ```python  \n\u003e def insert_data(name, age, gender):  \n\u003e \tdbname = 'TEST.db'  \n\u003e \tconn = sqlite3.connect(dbname)  \n\u003e \tcur = conn.cursor()  \n\u003e \t  \n\u003e \tcur.execute(**'**INSERT INTO person(name, age, gender) VALUES (?, ?, ?)', (name, age, gender))  \n\u003e \t  \n\u003e \tconn.commit()  \n\u003e \t  \n\u003e \tcur.close()  \n\u003e \tconn.close()  \n\u003e ```","children":[{"blockId":"1ada501e-f337-8199-882a-d1490230ba18","type":"code","parent":"```python\ndef insert_data(name, age, gender):\n\tdbname = 'TEST.db'\n\tconn = sqlite3.connect(dbname)\n\tcur = conn.cursor()\n\t\n\tcur.execute(**'**INSERT INTO person(name, age, gender) VALUES (?, ?, ?)', (name, age, gender))\n\t\n\tconn.commit()\n\t\n\tcur.close()\n\tconn.close()\n```","children":[]}]},{"blockId":"1ada501e-f337-81a0-8e01-c0febe51160d","type":"paragraph","parent":"この関数では、引数として受け取った`name`、`age`、`gender` の値が、それぞれのカラムに保存されるようになっています。","children":[]},{"blockId":"1ada501e-f337-81c6-8b48-dc1dd5fd261a","type":"paragraph","parent":"この関数は以下のように使用できます。","children":[]},{"blockId":"1ada501e-f337-81cc-a33d-d013b80e7478","type":"callout","parent":"\u003e `insert_data` の使用例  \n\u003e ```python  \n\u003e insert_data(\"Jeido\", 40, \"Woman\")  \n\u003e ```","children":[{"blockId":"1ada501e-f337-8175-8ce2-e6e9793feb82","type":"code","parent":"```python\ninsert_data(\"Jeido\", 40, \"Woman\")\n```","children":[]}]},{"blockId":"1ada501e-f337-8154-a257-cd14525e7e79","type":"paragraph","parent":"これで、カラム`name`に`”Jeido”`、カラム`age`に`40`、カラム`gender`に`”Woman”`がそれぞれ保存されます。","children":[]},{"blockId":"1ada501e-f337-8129-9f19-e245cbb8752f","type":"heading_2","parent":"## データの取得","children":[]},{"blockId":"1ada501e-f337-810a-8cce-d84d9540f735","type":"divider","parent":"---","children":[]},{"blockId":"1ada501e-f337-8143-8f6c-f6a78224d1d1","type":"paragraph","parent":"データを取得するための使い回し可能な関数の一例を示します。","children":[]},{"blockId":"1ada501e-f337-8197-a7bf-d9a860af3643","type":"callout","parent":"\u003e 任意のデータを取得する関数  \n\u003e ```python  \n\u003e def get_data(id):  \n\u003e     dbname = 'TEST.db'  \n\u003e     conn = sqlite3.connect(dbname)  \n\u003e     cur = conn.cursor()  \n\u003e   \n\u003e     cur.execute('SELECT * FROM person WHERE id = ?',(id,))  \n\u003e     data = cur.fetchall()  \n\u003e   \n\u003e     conn.commit()  \n\u003e   \n\u003e     cur.close()  \n\u003e     conn.close()  \n\u003e   \n\u003e     return data  \n\u003e ```  \n\u003e   \n\u003e   \n\u003e   \n\u003e すべてのデータを取得する関数  \n\u003e   \n\u003e ```python  \n\u003e def get_all_data():  \n\u003e     dbname = 'TEST.db'  \n\u003e     conn = sqlite3.connect(dbname)  \n\u003e     cur = conn.cursor()  \n\u003e   \n\u003e     cur.execute('SELECT * FROM person')  \n\u003e     data = cur.fetchall()  \n\u003e   \n\u003e     conn.commit()  \n\u003e   \n\u003e     cur.close()  \n\u003e     conn.close()  \n\u003e   \n\u003e     return data  \n\u003e ```","children":[{"blockId":"1ada501e-f337-81f5-9c72-c84584bac40a","type":"code","parent":"```python\ndef get_data(id):\n    dbname = 'TEST.db'\n    conn = sqlite3.connect(dbname)\n    cur = conn.cursor()\n\n    cur.execute('SELECT * FROM person WHERE id = ?',(id,))\n    data = cur.fetchall()\n\n    conn.commit()\n\n    cur.close()\n    conn.close()\n\n    return data\n```","children":[]},{"blockId":"1ada501e-f337-81b2-a916-d8d447f7c26f","type":"paragraph","parent":"","children":[]},{"blockId":"1ada501e-f337-812b-9d0a-d578409a7e40","type":"paragraph","parent":"すべてのデータを取得する関数","children":[]},{"blockId":"1ada501e-f337-810d-a90e-dddd8008a724","type":"code","parent":"```python\ndef get_all_data():\n    dbname = 'TEST.db'\n    conn = sqlite3.connect(dbname)\n    cur = conn.cursor()\n\n    cur.execute('SELECT * FROM person')\n    data = cur.fetchall()\n\n    conn.commit()\n\n    cur.close()\n    conn.close()\n\n    return data\n```","children":[]}]},{"blockId":"1ada501e-f337-81b5-9d60-deb9ad927811","type":"paragraph","parent":"`get_data` は引数の`id` の値でどのidの行を取得するかを指定できます。","children":[]},{"blockId":"1ada501e-f337-8189-a7e6-e5d6487fc7ee","type":"paragraph","parent":"`get_data`と`get_all_data`の戻り値は、それぞれ取得したデータのリストです。","children":[]},{"blockId":"1ada501e-f337-81d2-9d1a-e567a2050ae4","type":"callout","parent":"\u003e `get_data`の使用例  \n\u003e ```python  \n\u003e # 一行目のデータを取得する  \n\u003e print(get_data(1))  \n\u003e ```","children":[{"blockId":"1ada501e-f337-8138-bdc3-f2ad3d277974","type":"code","parent":"```python\n# 一行目のデータを取得する\nprint(get_data(1))\n```","children":[]}]},{"blockId":"1ada501e-f337-8155-ad9f-c86476c0ae27","type":"heading_2","parent":"## データの編集","children":[]},{"blockId":"1ada501e-f337-81e6-864b-f81bcad956e4","type":"divider","parent":"---","children":[]},{"blockId":"1ada501e-f337-8175-82c0-d1e227e13463","type":"paragraph","parent":"データを編集するための使い回し可能な関数の一例を示します。","children":[]},{"blockId":"1ada501e-f337-8102-9ec7-e0426dac65d7","type":"callout","parent":"\u003e データを編集する関数  \n\u003e ```python  \n\u003e def update_data(name, age, gender, id):  \n\u003e \tdbname = 'TEST.db'  \n\u003e \tconn = sqlite3.connect(dbname)  \n\u003e \tcur = conn.cursor()  \n\u003e \t  \n\u003e \tcur.execute('UPDATE person SET name = ?, age = ?, gender = ? WHERE id = ?', (name, age, gender, id))  \n\u003e \t  \n\u003e \tconn.commit()  \n\u003e \t  \n\u003e \tcur.close()  \n\u003e \tconn.close()  \n\u003e ```","children":[{"blockId":"1ada501e-f337-8184-83fc-e9fee05f8771","type":"code","parent":"```python\ndef update_data(name, age, gender, id):\n\tdbname = 'TEST.db'\n\tconn = sqlite3.connect(dbname)\n\tcur = conn.cursor()\n\t\n\tcur.execute('UPDATE person SET name = ?, age = ?, gender = ? WHERE id = ?', (name, age, gender, id))\n\t\n\tconn.commit()\n\t\n\tcur.close()\n\tconn.close()\n```","children":[]}]},{"blockId":"1ada501e-f337-810e-9258-e5bb14676c1c","type":"paragraph","parent":"`update_data` は、引数の`name`、`age`、`gender`が、それぞれのカラムの値となっており、引数`id`の値でどの行を編集するか指定できるようになっています。","children":[]},{"blockId":"1ada501e-f337-8192-8655-f47268c4f96d","type":"callout","parent":"\u003e `update_data` の使用例  \n\u003e ```python  \n\u003e update_data(\"Watanabe\", 32, \"Man\", 1)  \n\u003e ```","children":[{"blockId":"1ada501e-f337-81e2-9b70-e697f70e8722","type":"code","parent":"```python\nupdate_data(\"Watanabe\", 32, \"Man\", 1)\n```","children":[]}]},{"blockId":"1ada501e-f337-8184-a6ef-e788319f56d2","type":"paragraph","parent":"これで、一行目のデータを、カラム`name`を`\"Watanabe\"`に、カラム`age`を`32`に、カラム`gender`を`”Man”`に編集できます。","children":[]},{"blockId":"1ada501e-f337-814d-8296-eae128aaee8f","type":"heading_2","parent":"## データの削除","children":[]},{"blockId":"1ada501e-f337-817c-883d-d6d8e8880187","type":"divider","parent":"---","children":[]},{"blockId":"1ada501e-f337-81d4-a4be-f8b1a8ad3534","type":"paragraph","parent":"データを削除するための使い回し可能な関数の一例を示します。","children":[]},{"blockId":"1ada501e-f337-813e-a544-f4cb8e053879","type":"callout","parent":"\u003e データを削除する関数  \n\u003e ```python  \n\u003e def delete_data(id):  \n\u003e \tdbname = 'TEST.db'  \n\u003e \tconn = sqlite3.connect(dbname)  \n\u003e \tcur = conn.cursor()  \n\u003e \t  \n\u003e \tcur.execute('DELETE FROM person WHERE id = ?',(id,))  \n\u003e \t  \n\u003e \tconn.commit()  \n\u003e \t  \n\u003e \tcur.close()  \n\u003e \tconn.close()  \n\u003e ```","children":[{"blockId":"1ada501e-f337-8124-b792-df902462eaf7","type":"code","parent":"```python\ndef delete_data(id):\n\tdbname = 'TEST.db'\n\tconn = sqlite3.connect(dbname)\n\tcur = conn.cursor()\n\t\n\tcur.execute('DELETE FROM person WHERE id = ?',(id,))\n\t\n\tconn.commit()\n\t\n\tcur.close()\n\tconn.close()\n```","children":[]}]},{"blockId":"1ada501e-f337-81c8-a06d-c1b10885a10b","type":"paragraph","parent":"`delete_data` は、引数`id`の値によって、どのidの行を削除するかを指定できます。","children":[]},{"blockId":"1ada501e-f337-814b-a609-c9b15ab47a69","type":"callout","parent":"\u003e `delete_data`の使用例  \n\u003e ```python  \n\u003e # 一行目のデータを削除  \n\u003e delete_data(1)  \n\u003e ```","children":[{"blockId":"1ada501e-f337-8177-9813-f9a75c362510","type":"code","parent":"```python\n# 一行目のデータを削除\ndelete_data(1)\n```","children":[]}]}],"pageNavs":[{"title":"Home","id":"/posts"},{"title":"基礎班カリキュラム","id":"/posts/course/basic"},{"title":"後期","id":"/posts/course/後期"},{"title":"データベース基礎","id":"/posts/curriculums/1ada501e-f337-81e8-b251-df0f38a0cb23/1ada501e-f337-81e8-b251-df0f38a0cb23"},{"id":"/posts/curriculums/1ada501e-f337-81e8-b251-df0f38a0cb23/1ada501e-f337-81d2-8f41-cd45c5a72b38","title":"CRUD操作を使い回せるようにしよう"}],"childrenData":{"title":"データベース基礎","childPages":[{"title":"データベースとは","id":"1ada501e-f337-81ce-889f-d99449a4ba30"},{"title":"Pythonでデータベースを扱うためのライブラリ","id":"1ada501e-f337-81ea-92d1-dcb4d8f60e2a"},{"title":"データベースとの接続とテーブルの作成","id":"1ada501e-f337-8160-b03e-f28f8a18fa43"},{"title":"データの保存(Create)","id":"1ada501e-f337-8124-834c-d232ae4e3855"},{"title":"データの取得(Read)","id":"1ada501e-f337-81fe-9043-da67e48709a8"},{"title":"データの編集(Update)","id":"1ada501e-f337-815a-a9e6-d8cdd63afa9c"},{"title":"データの削除(Delete)","id":"1ada501e-f337-8190-b5d5-ff083def3250"},{"title":"テーブルの編集","id":"1ada501e-f337-81a2-bb7a-d5bc48cd5f09"},{"title":"CRUD操作を使い回せるようにしよう","id":"1ada501e-f337-81d2-8f41-cd45c5a72b38"},{"title":"マイグレーション","id":"1ada501e-f337-81ac-a7f5-efdaf65ef9e7"},{"title":"カラムの属性","id":"1ada501e-f337-81bc-8a50-df2e526e6153"},{"title":"SQL文","id":"1ada501e-f337-8175-826a-d32ae9e3e34d"}]},"pageId":"1ada501e-f337-81d2-8f41-cd45c5a72b38","title":"CRUD操作を使い回せるようにしよう"},"__N_SSG":true},"page":"/posts/curriculums/[curriculumId]/[pageId]","query":{"curriculumId":"1ada501e-f337-81e8-b251-df0f38a0cb23","pageId":"1ada501e-f337-81d2-8f41-cd45c5a72b38"},"buildId":"wmHzTY2ca4DNxQWEGX6zJ","assetPrefix":"/horizon-atlas","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>